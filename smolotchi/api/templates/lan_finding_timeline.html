{% extends "layout.html" %}
{% block page_title %}Finding Timeline{% endblock %}
{% block page_sub %}{{ fid }}{% endblock %}

{% block content %}
<section class="card">
  <div class="row between">
    <a class="pill" href="{{ url_for('lan_results') }}">← Back to LAN Results</a>
    <a class="pill" href="{{ url_for('lan_results') }}?finding={{ fid }}">Filter bundles</a>
    <a class="pill" href="{{ url_for('lan_finding_jump', fid=fid) }}">Jump (latest active)</a>
    <form method="post" action="{{ url_for('lan_baseline_add') }}" class="inline-form">
      <input type="hidden" name="scope" value="{{ app_cfg.lan.default_scope if app_cfg and app_cfg.lan else '' }}">
      <input type="hidden" name="fid" value="{{ fid }}">
      <input type="hidden" name="back" value="{{ request.full_path }}">
      <button class="btn secondary" type="submit">Add to baseline</button>
    </form>
  </div>
</section>

<section class="card">
  <h3 class="mb-sm">Overview</h3>
  {% if first %}
    <div class="events">
      <div class="evt">
        <div class="evt-top">First seen</div>
        <div class="muted">{{ first.ts_str }} · {{ first.state }}</div>
        <div class="row mt-sm">
          <a class="link" href="{{ url_for('lan_result_details', bundle_id=first.bundle_id) }}">Open bundle</a>
        </div>
      </div>
      <div class="evt">
        <div class="evt-top">Last seen</div>
        <div class="muted">{{ last.ts_str }} · {{ last.state }}</div>
        <div class="row mt-sm">
          <a class="link" href="{{ url_for('lan_result_details', bundle_id=last.bundle_id) }}">Open bundle</a>
        </div>
      </div>
    </div>
  {% else %}
    <div class="muted">No occurrences found.</div>
  {% endif %}
</section>

<section class="card">
  <h3 class="mb-sm">History</h3>
  <div class="events">
    {% for h in history %}
      <div class="evt">
        <div class="evt-top">{{ h.ts_str }}</div>
        <div class="muted">{{ h.state }} · bundle: {{ h.bundle_id }}</div>
        <div class="row mt-sm">
          <a class="link" href="{{ url_for('lan_result_details', bundle_id=h.bundle_id) }}">Open</a>
        </div>
      </div>
    {% else %}
      <div class="muted">No events.</div>
    {% endfor %}
  </div>
</section>
{% endblock %}
