{% extends "layout.html" %}
{% block page_title %}AI Plans{% endblock %}
{% block page_sub %}Generated & executed plans{% endblock %}

{% block content %}
<section class="card">
  <div class="row between">
    <div>
      <h3 class="h3-tight-sm">Plans</h3>
      <div class="muted">Latest AI plans (generate a new one from here)</div>
    </div>
    <div class="row">
      <a class="btn secondary" href="{{ url_for('ai_jobs') }}">AI Jobs</a>
      <form method="post" action="{{ url_for('ai_plan') }}">
        <input type="hidden" name="scope" value="10.0.10.0/24" />
        <input type="hidden" name="note" value="" />
        <button class="btn" type="submit">Generate Plan</button>
      </form>
    </div>
  </div>
  <div class="events">
    {% for p in plans %}
      <div class="evt">
        <div class="evt-top">{{ p.meta.title }}</div>
        <div class="muted">plan id: {{ p.plan_id }}</div>
        {% if p.data.scope %}<div class="muted">scope: {{ p.data.scope }}</div>{% endif %}
        {% if p.data.note %}<div class="muted">note: {{ p.data.note }}</div>{% endif %}
        <div class="muted">artifact id: {{ p.meta.id }}</div>
        <div class="row mt-sm">
          <a class="btn" href="{{ url_for('ai_plan_detail', artifact_id=p.meta.id) }}">Open</a>
          <form method="post" action="{{ url_for('ai_run') }}">
            <input type="hidden" name="plan_artifact_id" value="{{ p.meta.id }}" />
            <button class="btn secondary" type="submit">Run (safe)</button>
          </form>
        </div>

        {% if runs_by_plan.get(p.plan_id) %}
          <div class="muted mt-xs">
            Runs: {{ runs_by_plan[p.plan_id]|length }}
          </div>
        {% endif %}
      </div>
    {% else %}
      <div class="evt">
        <div class="evt-top">No AI plans yet</div>
        <div class="muted">Generate a plan to review suggested steps and run them safely.</div>
        <div class="row mt-sm">
          <form method="post" action="{{ url_for('ai_plan') }}">
            <input type="hidden" name="scope" value="10.0.10.0/24" />
            <input type="hidden" name="note" value="" />
            <button class="btn" type="submit">Generate Plan</button>
          </form>
          <a class="btn secondary" href="{{ url_for('dashboard') }}">Back to Dashboard</a>
        </div>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
