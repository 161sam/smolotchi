{% extends "layout.html" %}
{% block page_title %}Dashboard{% endblock %}
{% block page_sub %}State, Health, Quick Actions{% endblock %}

{% block content %}
<section class="card">
  <div class="kpi-grid">
    <div class="kpi">
      <div class="label">Current state</div>
      <div class="value">{{ status_evt.payload.state if status_evt else "unknown" }}</div>
    </div>
    <div class="kpi">
      <div class="label">Note</div>
      <div class="value" style="font-size:14px">{{ status_evt.payload.note if status_evt else "" }}</div>
    </div>
    <div class="kpi">
      <div class="label">DB</div>
      <div class="value" style="font-size:14px">events.db</div>
    </div>
  </div>
</section>

{% if health_evt %}
<section class="card">
  <h3 style="margin:0 0 10px 0">Engine health</h3>
  <div class="events">
    {% for h in health_evt.payload.engines %}
      <div class="evt">
        <div class="evt-top">{{ h.name }} — {{ "OK" if h.ok else "FAIL" }}</div>
        <pre>{{ h.detail }}</pre>
      </div>
    {% endfor %}
  </div>
</section>
{% endif %}

<section class="card">
  <h3 style="margin:0 0 10px 0">Quick actions</h3>
  <form method="post" action="/handoff" class="row">
    <input name="tag" value="lab-approved" />
    <input name="note" placeholder="Reason / Ticket / Lab-Case" style="min-width:280px" />
    <button type="submit">Handoff → LAN_OPS</button>
  </form>
</section>

<section class="card">
  <h3 style="margin:0 0 10px 0">Recent events</h3>
  <div class="events">
    {% for e in events %}
      <div class="evt">
        <div class="evt-top">{{ e.topic }}</div>
        <pre>{{ e.payload }}</pre>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
