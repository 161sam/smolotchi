{% extends "layout.html" %}
{% block page_title %}AI Stages{% endblock %}
{% block page_sub %}Manual approvals (execution resumes on approval){% endblock %}

{% block content %}
<section class="card">
  <div class="row between">
    <a href="{{ url_for('ai_plans') }}" class="btn secondary">‚Üê Back to AI Plans</a>
    <a href="{{ url_for('ai_stage_new') }}" class="btn">New stage request</a>
  </div>
  <div class="row mt-md">
    <span class="pill">cap.intrusive: {{ 'ON' if intrusive_ok else 'OFF' }}</span>
    <span class="pill">cap.dangerous: {{ 'ON' if dangerous_ok else 'OFF' }}</span>
    <span class="pill">execution: gated</span>
  </div>
</section>

<section class="card">
  <h3 class="mb-sm">Requests</h3>
  <div class="events">
    {% for r in reqs %}
      <div class="evt">
        <div class="evt-top">{{ r.title }}</div>
        <div class="muted">id: {{ r.id }}</div>

        <div class="row mt-sm">
          {% if r.id in approved %}
            <span class="pill">approved</span>
          {% else %}
            <span class="pill">not approved</span>
          {% endif %}
          {% if r.tags %}
            <span class="pill">risk: {{ r.tags[-1] }}</span>
          {% endif %}
        </div>

        {% if r.id not in approved %}
          <form method="post" action="/ai/stage/{{ r.id }}/approve" class="mt-md">
            <button class="btn secondary" type="submit">Approve + resume</button>
          </form>
        {% endif %}
      </div>
    {% else %}
      <div class="empty">
        <p><strong>No stage requests yet.</strong></p>
        <p class="muted">Manual approvals appear here when a plan hits a gated step.</p>
        <div class="btn-row">
          <a class="btn" href="{{ url_for('ai_stage_new') }}">New stage request</a>
          <a class="btn secondary" href="{{ url_for('ai_plans') }}">Back to AI Plans</a>
        </div>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
